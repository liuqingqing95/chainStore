{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\api\\controller\\goods.js"
    ],
    "names": [
        "Base",
        "require",
        "moment",
        "module",
        "exports",
        "indexAction",
        "model",
        "goodsList",
        "select",
        "success",
        "detailAction",
        "goodsId",
        "get",
        "userId",
        "getLoginUserId",
        "info",
        "where",
        "id",
        "is_delete",
        "find",
        "think",
        "isEmpty",
        "fail",
        "gallery",
        "goods_id",
        "order",
        "limit",
        "addFootprint",
        "productList",
        "getProductList",
        "goodsNumber",
        "item",
        "goods_number",
        "specificationList",
        "getSpecificationList",
        "goodsShareAction",
        "field",
        "listAction",
        "keyword",
        "sort",
        "sales",
        "whereMap",
        "is_on_sale",
        "name",
        "add",
        "user_id",
        "add_time",
        "parseInt",
        "Date",
        "getTime",
        "orderMap",
        "retail_price",
        "sell_volume",
        "sort_order",
        "goodsData",
        "countAction",
        "goodsCount",
        "count"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\api\\controller\\goods.js",
    "sourcesContent": [
        "const Base = require('./base.js');\r\nconst moment = require('moment');\r\nmodule.exports = class extends Base {\r\n    async indexAction() {\r\n        const model = this.model('goods');\r\n        const goodsList = await model.select();\r\n        return this.success(goodsList);\r\n    }\r\n    /**\r\n     * 商品详情页数据\r\n     * @returns {Promise.<Promise|PreventPromise|void>}\r\n     */\r\n    async detailAction() {\r\n        const goodsId = this.get('id');\r\n\t\tconst userId = this.getLoginUserId();;\r\n        const model = this.model('goods');\r\n        let info = await model.where({\r\n            id: goodsId,\r\n\t\t\tis_delete:0\r\n        }).find();\r\n\t\tif(think.isEmpty(info)){\r\n\t\t\treturn this.fail('该商品不存在或已下架');\r\n\t\t}\r\n        const gallery = await this.model('goods_gallery').where({\r\n            goods_id: goodsId,\r\n            is_delete: 0,\r\n        }).order('sort_order').limit(6).select();\r\n        await this.model('footprint').addFootprint(userId, goodsId);\r\n        let productList = await model.getProductList(goodsId);\r\n        let goodsNumber = 0;\r\n        for (const item of productList) {\r\n            if (item.goods_number > 0) {\r\n                goodsNumber = goodsNumber + item.goods_number;\r\n            }\r\n        }\r\n        let specificationList = await model.getSpecificationList(goodsId);\r\n        info.goods_number = goodsNumber;\r\n        return this.success({\r\n            info: info,\r\n            gallery: gallery,\r\n            specificationList: specificationList,\r\n            productList: productList\r\n        });\r\n    }\r\n    async goodsShareAction() {\r\n        const goodsId = this.get('id');\r\n        const info = await this.model('goods').where({\r\n            id: goodsId\r\n        }).field('name,retail_price').find();\r\n        return this.success(info);\r\n    }\r\n    /**\r\n     * 获取商品列表\r\n     * @returns {Promise.<*>}\r\n     */\r\n    async listAction() {\r\n\t\tconst userId = this.getLoginUserId();;\r\n        const keyword = this.get('keyword');\r\n        const sort = this.get('sort');\r\n        const order = this.get('order');\r\n        const sales = this.get('sales');\r\n        const model = this.model('goods');\r\n        const whereMap = {\r\n            is_on_sale: 1,\r\n            is_delete: 0,\r\n        };\r\n        if (!think.isEmpty(keyword)) {\r\n            whereMap.name = ['like', `%${keyword}%`];\r\n            // 添加到搜索历史\r\n            await this.model('search_history').add({\r\n                keyword: keyword,\r\n                user_id: userId,\r\n                add_time: parseInt(new Date().getTime() / 1000)\r\n            });\r\n            //    TODO 之后要做个判断，这个词在搜索记录中的次数，如果大于某个值，则将他存入keyword\r\n        }\r\n        // 排序\r\n        let orderMap = {};\r\n        if (sort === 'price') {\r\n            // 按价格\r\n            orderMap = {\r\n                retail_price: order\r\n            };\r\n        } else if (sort === 'sales') {\r\n            // 按价格\r\n            orderMap = {\r\n                sell_volume: sales\r\n            };\r\n        } else {\r\n            // 按商品添加时间\r\n            orderMap = {\r\n                sort_order: 'asc'\r\n            };\r\n        }\r\n        const goodsData = await model.where(whereMap).order(orderMap).select();\r\n        return this.success(goodsData);\r\n    }\r\n    /**\r\n     * 在售的商品总数\r\n     * @returns {Promise.<Promise|PreventPromise|void>}\r\n     */\r\n    async countAction() {\r\n        const goodsCount = await this.model('goods').where({\r\n            is_delete: 0,\r\n            is_on_sale: 1\r\n        }).count('id');\r\n        return this.success({\r\n            goodsCount: goodsCount\r\n        });\r\n    }\r\n};"
    ]
}